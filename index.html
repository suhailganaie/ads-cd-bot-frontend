<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no"
    />
    <title>ADS BOT</title>

    <!-- Telegram Mini Apps SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- Required by TMA before any app logic [web:3300] -->

    <!-- Ad SDKs (deferred) -->
    <script defer src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script> <!-- Correct SDK per docs [web:3707] -->
    <script
      defer
      src="//libtl.com/sdk.js"
      data-zone="9822309"
      data-sdk="show_9822309"
    ></script>

    <!-- Unified ad helper + anti-overlap queue -->
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        try {
          const tg = window?.Telegram?.WebApp;
          tg?.ready?.();
          tg?.expand?.();
        } catch {}

        const queue = [];
        let showing = false;
        const next = () => {
          if (showing) return;
          const job = queue.shift();
          if (!job) return;
          showing = true;
          Promise.resolve(job())
            .catch(() => {})
            .finally(() => {
              showing = false;
              setTimeout(next, 1200);
            });
        };

        // Request + display flow for Adexium as per advanced integration
        function showAdexium(opts) {
          return new Promise((resolve) => {
            try {
              if (!window.AdexiumWidget) return resolve();
              const adx = new window.AdexiumWidget({
                wid: opts.wid,
                adFormat: opts.format || 'interstitial',
                // debug: true, // enable only while testing [remove in prod]
              });

              const onRecv = (ad) => {
                adx.displayAd(ad);
              };
              const onDone = () => {
                adx.off?.('adReceived', onRecv);
                adx.off?.('adPlaybackCompleted', onDone);
                resolve('done');
              };
              const onNo = () => {
                adx.off?.('noAdFound', onNo);
                resolve('noAd');
              };

              adx.on?.('adReceived', onRecv);
              adx.on?.('adPlaybackCompleted', onDone);
              adx.on?.('noAdFound', onNo);

              adx.requestAd?.(opts.format || 'interstitial');
            } catch {
              resolve();
            }
          });
        }

        // Montage/libtl example
        function showMontage() {
          return new Promise((resolve) => {
            try {
              const fn = window?.show_9822309;
              if (typeof fn === 'function') {
                const p = fn({
                  type: 'inApp',
                  inAppSettings: {
                    frequency: 1,
                    capping: 1,
                    interval: 3600,
                    timeout: 50,
                    everyPage: false,
                  },
                });
                if (p?.then) p.then(() => resolve('done')).catch(() => resolve());
                else resolve('done');
              } else {
                resolve();
              }
            } catch {
              resolve();
            }
          });
        }

        // Public API for pages
        window.ads = {
          show(provider, opts = {}) {
            queue.push(() => {
              if (provider === 'adexium') {
                return showAdexium(opts); // follows requestAd -> adReceived -> displayAd [web:3707]
              }
              if (provider === 'montage') {
                return showMontage();
              }
              return Promise.resolve();
            });
            next();
          },
        };
      });
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="src/index.jsx"></script>
  </body>
</html>
